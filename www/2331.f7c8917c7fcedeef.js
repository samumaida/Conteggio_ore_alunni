"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2331],{2331:(I,g,s)=>{s.r(g),s.d(g,{HomePageModule:()=>N});var h=s(177),a=s(4742),u=s(4341),m=s(4964),c=s(467),e=s(3953),p=s(1985),_=s(6354),f=s(8079);let v=(()=>{class r{constructor(o){this.firestore=o}addData(o,t){return this.firestore.collection(o).add(t)}getData(o){return new p.c(t=>{this.firestore.collection(o).snapshotChanges().subscribe(i=>{const n=i.map(l=>({id:l.payload.doc.id,...l.payload.doc.data()}));t.next(n)},i=>{t.error(i)})})}updateData(o,t,i){var n=this;return(0,c.A)(function*(){return n.firestore.collection(o).doc(t).update(i)})()}deleteData(o,t){return t&&""!==t.trim()?(console.log("collection:",o),console.log("id:",t),this.firestore.collection(o).doc(t).delete().then(()=>{console.log(`Documento con ID ${t} eliminato con successo.`)}).catch(i=>{throw console.error("Errore durante l'eliminazione del documento:",i),i})):(console.error("Errore: ID del documento non valido"),Promise.reject(new Error("ID del documento non valido")))}getCollection(o){return this.firestore.collection(o)}getDocument(o,t){return this.getCollection(o).doc(t).valueChanges()}getDataWithId(o){return this.firestore.collection(o).snapshotChanges().pipe((0,_.T)(t=>t.map(i=>{const n=i.payload.doc.data();return{id:i.payload.doc.id,...n}})))}static{this.\u0275fac=function(t){return new(t||r)(e.KVO(f.Qe))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var T=s(1182);function b(r,O){if(1&r){const o=e.RV6();e.j41(0,"div",5)(1,"ion-row",6)(2,"ion-col",7)(3,"ion-input",8),e.mxI("ngModelChange",function(i){const n=e.eBV(o).$implicit;return e.DH7(n.modifiedNome,i)||(n.modifiedNome=i),e.Njj(i)}),e.bIt("ngModelChange",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.checkNameChange(i))}),e.k0s(),e.j41(4,"ion-button",9),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.salvaNome(i))}),e.EFF(5,"Salva nome"),e.k0s(),e.j41(6,"ion-button",10),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.eliminaBambino(i))}),e.EFF(7," Elimina "),e.k0s()(),e.j41(8,"ion-col",11)(9,"ion-input",12),e.mxI("ngModelChange",function(i){const n=e.eBV(o).$implicit,l=e.XpG();return e.DH7(l.oreDaDedurre[n.nome],i)||(l.oreDaDedurre[n.nome]=i),e.Njj(i)}),e.bIt("focus",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.resetInput(n.oreDaDedurre,i.nome))}),e.k0s(),e.j41(10,"ion-button",9),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.deduciOre(i))}),e.EFF(11,"Scala Ore"),e.k0s()(),e.j41(12,"ion-col",11)(13,"ion-input",13),e.mxI("ngModelChange",function(i){const n=e.eBV(o).$implicit,l=e.XpG();return e.DH7(l.oreDaAggiungere[n.nome],i)||(l.oreDaAggiungere[n.nome]=i),e.Njj(i)}),e.bIt("focus",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.resetInput(n.oreDaAggiungere,i.nome))}),e.k0s(),e.j41(14,"ion-button",9),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.incrementaOre(i))}),e.EFF(15,"Aggiungi Ore"),e.k0s()(),e.j41(16,"ion-col",14)(17,"div",15),e.nrm(18,"ion-progress-bar",16),e.j41(19,"span",17),e.EFF(20),e.k0s()()()(),e.j41(21,"ion-row")(22,"div",18)(23,"ion-col",11)(24,"ion-input",19),e.mxI("ngModelChange",function(i){const n=e.eBV(o).$implicit;return e.DH7(n.modifiedOreTotali,i)||(n.modifiedOreTotali=i),e.Njj(i)}),e.bIt("ngModelChange",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.checkOreTotaliChange(i))}),e.k0s(),e.j41(25,"ion-button",9),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.modificaOreTotali(i))}),e.EFF(26,"Salva Ore Totali"),e.k0s()(),e.j41(27,"ion-col",11)(28,"ion-badge",20),e.EFF(29),e.k0s(),e.j41(30,"ion-button",1),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.resetOreFatte(i))}),e.EFF(31,"Reset Ore Fatte"),e.k0s()(),e.j41(32,"ion-col",11)(33,"ion-badge",21),e.EFF(34),e.k0s(),e.j41(35,"ion-button",1),e.bIt("click",function(){const i=e.eBV(o).$implicit,n=e.XpG();return e.Njj(n.resetOreTotali(i))}),e.EFF(36,"Reset Ore Totali"),e.k0s()()()()()}if(2&r){const o=O.$implicit,t=e.XpG();e.R7$(3),e.R50("ngModel",o.modifiedNome),e.Y8G("placeholder",o.nome),e.R7$(),e.Y8G("disabled",!o.isNameModified),e.R7$(5),e.R50("ngModel",t.oreDaDedurre[o.nome]),e.R7$(),e.Y8G("disabled",!t.oreDaDedurre[o.nome]),e.R7$(3),e.R50("ngModel",t.oreDaAggiungere[o.nome]),e.R7$(),e.Y8G("disabled",!t.checkOreChange(o)),e.R7$(4),e.Y8G("value",t.getOreFatteProgresso(o)),e.R7$(2),e.SpI(" ",t.getPercentualeMancante(o),"% "),e.R7$(4),e.R50("ngModel",o.modifiedOreTotali),e.Y8G("placeholder",o.oreTotali.toString()),e.R7$(),e.Y8G("disabled",!t.isOreTotaliModified(o)),e.R7$(4),e.SpI("Ore fatte: ",o.oreFatte,""),e.R7$(5),e.SpI("Ore mancanti: ",o.oreTotali-o.oreFatte,"")}}const j=[{path:"",component:(()=>{class r{constructor(o,t,i,n,l){this.firestoreService=o,this.afAuth=t,this.router=i,this.firestore=n,this.cd=l,this.userId=null,this.bambini=[],this.oreDaAggiungere={},this.oreDaDedurre={},this.afAuth.authState.subscribe(d=>{d?(this.userId=d.uid,console.log("User ID:",this.userId),this.loadBambini()):(console.log("Nessun utente autenticato"),this.userId=null)})}ngOnInit(){setTimeout(()=>{console.log("bambini",this.bambini)},1e3),this.afAuth.authState.subscribe(o=>{o?(console.log("Utente autenticato:",o.uid),this.loadBambini()):(console.log("Nessun utente autenticato, reindirizzamento a login"),this.router.navigate(["/login"]))})}logout(){this.afAuth.signOut().then(()=>{this.router.navigate(["/login"])})}loadBambini(){this.userId?this.firestoreService.getData("alunni").subscribe(o=>{this.bambini=o.filter(t=>t.userId===this.userId).map(t=>{const{id:i,...n}=t;return{id:i,...n}}),console.log("Dati recuperati:",this.bambini)},o=>{console.error("Errore nel recupero dei dati:",o)}):console.error("Errore: nessun utente autenticato")}creaNuovoAlunno(){var o=this;return(0,c.A)(function*(){if(!o.userId)return void console.error("Errore: l'utente non \xe8 autenticato");const i={nome:"Nuovo Bambino",oreTotali:0,oreFatte:0,modifiedNome:"",modifiedOreTotali:null,isNameModified:!1,userId:o.userId};try{const n=yield o.firestoreService.addData("alunni",i),l={id:n.id,...i};o.bambini.push(l),console.log("Nuovo bambino creato con ID:",n.id),o.loadBambini()}catch(n){console.error("Errore nella creazione del bambino:",n)}})()}onEdit(o){var t=this;return(0,c.A)(function*(){const i={...o};yield t.saveBambino(i)})()}saveBambino(o){var t=this;return(0,c.A)(function*(){const i={id:o.id,nome:o.nome,oreFatte:o.oreFatte,oreTotali:o.oreTotali,modifiedNome:o.modifiedNome,modifiedOreTotali:o.modifiedOreTotali,isNameModified:o.isNameModified,userId:t.userId?t.userId:""};try{if(o.id)yield t.firestoreService.updateData("alunni",o.id,i),console.log("Documento aggiornato con successo con ID:",o.id);else{const n=yield t.firestoreService.addData("alunni",i);o.id=n.id,console.log("Documento creato con successo con ID:",o.id)}}catch(n){console.error("Errore nell'aggiornamento o creazione del documento: ",n)}t.loadBambini()})()}eliminaBambino(o){var t=this;return(0,c.A)(function*(){if(o.id)try{yield t.firestoreService.deleteData("alunni",o.id),console.log(`Bambino ${o.nome} eliminato con successo.`),t.bambini=t.bambini.filter(i=>i.id!==o.id)}catch(i){console.error("Errore durante l'eliminazione del bambino:",i)}else console.error("Errore: ID del bambino non valido")})()}modificaOreTotali(o){var t=this;return(0,c.A)(function*(){if(null!=o.modifiedOreTotali){const i=Number(o.modifiedOreTotali);isNaN(i)?console.error("Valore non valido per modifiedOreTotali:",o.modifiedOreTotali):(i<o.oreFatte?(o.oreTotali=i,o.oreFatte=Math.min(o.oreFatte,i)):o.oreTotali=i,o.modifiedOreTotali=null,yield t.saveBambino(o))}else console.log("Nessuna modifica delle ore totali da applicare per:",o)})()}resetInput(o,t){o[t]=""}checkNameChange(o){o.isNameModified=o.modifiedNome!==o.nome,this.timerNome&&clearTimeout(this.timerNome),this.timerNome=setTimeout(()=>{console.log("bambino salvato"),this.salvaNome(o)},3e3)}salvaNome(o){var t=this;return(0,c.A)(function*(){if(o.isNameModified){const i={...o,nome:o.modifiedNome,isNameModified:!1};yield t.onEdit(i)}})()}incrementaOre(o){const t=Number(this.oreDaAggiungere[o.nome])||0;t>0&&(o.oreTotali+=t,this.oreDaAggiungere[o.nome]="",this.saveBambino(o))}deduciOre(o){const t=Number(this.oreDaDedurre[o.nome])||0;t>0&&(o.oreFatte+=t,this.oreDaDedurre[o.nome]="",this.saveBambino(o))}checkOreChange(o){return Number(this.oreDaAggiungere[o.nome])>0}getOreFatteProgresso(o){return Math.max(0,o.oreTotali-o.oreFatte)/Math.max(o.oreTotali,1)}checkOreTotaliChange(o){this.timerOre&&clearTimeout(this.timerOre),this.timerOre=setTimeout(()=>{console.log("ore totali slavate"),this.modificaOreTotali(o)},3e3)}isOreTotaliModified(o){return null!==o.modifiedOreTotali&&o.modifiedOreTotali!==o.oreTotali}resetOreFatte(o){confirm(`Sei sicuro di voler resettare le ore fatte per ${o.nome}?`)&&(o.oreFatte=0,this.saveBambino(o))}resetOreTotali(o){confirm(`Sei sicuro di voler resettare le ore totali per ${o.nome}?`)&&(o.oreTotali=0,o.oreFatte=Math.min(o.oreFatte,o.oreTotali),this.saveBambino(o))}getPercentualeMancante(o){return Math.round((o.oreTotali-o.oreFatte)/Math.max(o.oreTotali,1)*100)}svuotaCollezioneAlunni(){var o=this;return(0,c.A)(function*(){try{const t=yield o.firestore.collection("alunni").get().toPromise();if(t?.empty)console.log("Nessun documento da eliminare nella collezione alunni.");else{const i=o.firestore.firestore.batch();t?.forEach(n=>{i.delete(n.ref)}),yield i.commit(),console.log("Tutti i documenti nella collezione alunni sono stati eliminati.")}}catch(t){console.error("Errore durante lo svuotamento della collezione alunni:",t)}})()}static{this.\u0275fac=function(t){return new(t||r)(e.rXU(v),e.rXU(T.DS),e.rXU(m.Ix),e.rXU(f.Qe),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-home"]],decls:17,vars:1,consts:[["slot","end"],[3,"click"],["name","log-out-outline"],["expand","full",3,"click"],["class","nome-container","style","background-color: lightgrey; border-radius: 1em;",4,"ngFor","ngForOf"],[1,"nome-container",2,"background-color","lightgrey","border-radius","1em"],[2,"width","100%"],["size-xs","12","size-sm","12","size-md","12","size-l","12","size-xl","12",2,"display","flex","align-items","center","justify-content","space-around","flex-wrap","wrap"],["type","text",2,"width","120px","margin","5px","background-color","aliceblue","border-radius","1em",3,"ngModelChange","ngModel","placeholder"],[3,"click","disabled"],["color","danger",3,"click"],["size-xs","12","size-sm","12","size-md","5.5","size-l","2.5","size-xl","2.5",2,"display","flex","align-items","center","margin-right","10px","justify-content","space-around"],["type","number","placeholder","Ore da scalare",2,"width","120px","background-color","aliceblue","margin","5px","border-radius","1em",3,"ngModelChange","focus","ngModel"],["type","number","placeholder","Ore da aggiungere",2,"width","120px","background-color","aliceblue","margin","5px","border-radius","1em",3,"ngModelChange","focus","ngModel"],["size-xs","12","size-sm","12","size-md","12","size-l","12","size-xl","12",2,"display","flex","align-items","center","justify-content","space-around"],[2,"position","relative","width","100%"],[2,"margin-top","10px","height","20px","border-radius","1em",3,"value"],[2,"position","absolute","width","100%","text-align","center","top","9px","left","0","color","white"],[2,"display","flex","align-items","center","justify-content","space-around","width","100%","flex-flow","wrap"],["type","number",2,"width","120px","background-color","aliceblue","margin","5px","border-radius","1em",3,"ngModelChange","ngModel","placeholder"],[2,"min-width","auto","height","30px","background-color","green","display","flex","align-items","center","justify-content","center","font-size","large"],[2,"min-width","auto","height","30px","background-color","darkred","display","flex","align-items","center","justify-content","center","font-size","large"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Conteggio Ore"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return i.logout()}),e.nrm(6,"ion-icon",2),e.EFF(7," Logout "),e.k0s()()()(),e.j41(8,"ion-content")(9,"ion-card")(10,"ion-card-header")(11,"ion-card-title"),e.EFF(12,"Ore Rimanenti per i Ragazzi"),e.k0s()(),e.j41(13,"ion-card-content")(14,"ion-button",3),e.bIt("click",function(){return i.creaNuovoAlunno()}),e.EFF(15,"Crea Nuovo Alunno"),e.k0s(),e.DNE(16,b,37,14,"div",4),e.k0s()()()),2&t&&(e.R7$(16),e.Y8G("ngForOf",i.bambini))},dependencies:[h.Sq,u.BC,u.vS,a.In,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.hU,a.W9,a.eU,a.iq,a.$w,a.FH,a.ln,a.BC,a.ai,a.su,a.Gw],styles:[".nome-container[_ngcontent-%COMP%]{margin:10px 0}ion-badge[_ngcontent-%COMP%]{background-color:gray}"]})}}return r})()}];let D=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[m.iI.forChild(j),m.iI]})}}return r})(),N=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[h.MD,u.YN,a.bv,D]})}}return r})()}}]);